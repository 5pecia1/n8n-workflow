(()=>{"use strict";var e={924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RANGE=t.TIME_ZONE=t.NOTION_DATE_PROPERTY_NAME=t.NOTION_GCAL_ID_PROPERTY_NAME=t.ADDED_TO_NOTION_MARK=t.ADD_TO_NOTION_MARK=t.ONE_DAY_UNIX_TIME=void 0,t.ONE_DAY_UNIX_TIME=864e5,t.ADD_TO_NOTION_MARK=["notion: ","notion : ","Notion: ","Notion : ","notion:","notion :","Notion:","Notion :"],t.ADDED_TO_NOTION_MARK="NOTION_ID: ",t.NOTION_GCAL_ID_PROPERTY_NAME="GCal Id",t.NOTION_DATE_PROPERTY_NAME="Start-End Time",t.TIME_ZONE="Asia/Seoul",t.DEFAULT_RANGE=18e5},825:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeEventState=void 0;const a=n(924),s=n(103);t.makeEventState=function(e){const t=e.start.dateTime||e.start.date,n=e.end.dateTime||e.end.date,i=Date.parse(t.includes("T")?t:t+`T00:00:00${s.getTimeZone()}`),o=Date.parse(n.includes("T")?n:n+`T00:00:00${s.getTimeZone()}`),r=!!e.start.date;return{eventStart:i,eventEnd:o,isEventAllDay:r,isEventOneDayAllDay:r&&o-i===a.ONE_DAY_UNIX_TIME}}},207:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makePageState=void 0;const a=n(924),s=n(103);t.makePageState=function(e){const t=e.properties[a.NOTION_DATE_PROPERTY_NAME].date.start,n=e.properties[a.NOTION_DATE_PROPERTY_NAME].date.end?e.properties[a.NOTION_DATE_PROPERTY_NAME].date.end:null,i=Date.parse(t.includes("T")?t:t+`T00:00:00${s.getTimeZone()}`),o=n?Date.parse(n.includes("T")?n:n+`T00:00:00${s.getTimeZone()}`):null,r=!t.includes("T");return{pageStart:i,pageEnd:o,isPageAllDay:r,isPageOneDayAllDAy:r&&null===o}}},103:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeIso8601WithTZ=t.getTimeZone=t.getTImeZoneOffset=void 0;const a=n(924);function s(){const e=Intl.DateTimeFormat([],{timeZone:a.TIME_ZONE,timeZoneName:"short"}).format(new Date).split(" ")[1].slice(3);let t=60*parseInt(e.split(":")[0]);return e.includes(":")&&(t+=parseInt(e.split(":")[1])),t}function i(){const e=s();let t=Math.abs(e/60),n=Math.abs(e%60),a="Z";return t<10&&(t="0"+t),n<10&&(n="0"+n),e>0?a="+"+t+":"+n:e<0&&(a="-"+t+":"+n),a}t.getTImeZoneOffset=s,t.getTimeZone=i,t.makeIso8601WithTZ=function(e){const t=s();t>0?e+=60*Math.abs(t)*1e3:t<0&&(e-=60*Math.abs(t)*1e3);const n=new Date(e).toISOString();return n.substring(0,n.length-5)+i()}},147:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeCalendarEventDate=t.makeNotionPageDate=t.makeEventDescription=t.makePageId=void 0;const a=n(924),s=n(825),i=n(207),o=n(103);t.makePageId=function(e){const t=e.description;let n;return n=t.includes("\n")?t.substring(0,t.indexOf("\n")):t.substring(0,t.indexOf("<br>")),n.substring(a.ADDED_TO_NOTION_MARK.length)},t.makeEventDescription=function(e){return`${a.ADDED_TO_NOTION_MARK}${e.id}\nhttps://notion.so/${e.id.replace(/-/g,"")}\n`},t.makeNotionPageDate=function(e){const{eventStart:t,eventEnd:n,isEventAllDay:i,isEventOneDayAllDay:r}=s.makeEventState(e),_=o.makeIso8601WithTZ(t),d=r?null:o.makeIso8601WithTZ(i?n-a.ONE_DAY_UNIX_TIME:n);return{is_all_day:i,timezone:a.TIME_ZONE,start:i?_.substring(0,_.indexOf("T")):_,end:null==d?null:i?d.substring(0,d.indexOf("T")):d}},t.makeCalendarEventDate=function(e){const{pageStart:t,pageEnd:n,isPageAllDay:s}=i.makePageState(e),r=o.makeIso8601WithTZ(t),_=s?o.makeIso8601WithTZ((n||t)+a.ONE_DAY_UNIX_TIME):o.makeIso8601WithTZ(n||t+a.DEFAULT_RANGE);return{date:{start:s?r.substring(0,r.indexOf("T")):r,end:s?_.substring(0,_.indexOf("T")):_,is_all_day:s,timezone:a.TIME_ZONE}}}}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}var a={};for(var s in(()=>{var e=a;Object.defineProperty(e,"__esModule",{value:!0}),e.main=void 0;const t=n(924),s=n(207),i=n(825),o=n(147);e.main=function(e){let n=e[0].json.calendar,a=e[1].json.notion;Object.keys(n[0]).length||(n=[]),Object.keys(a[0]).length||(a=[]);const r={create_events:[],create_pages:[],delete_events:[],delete_pages:[],update_events:[],update_pages:[]},_=a.filter((e=>e.properties&&e.properties[t.NOTION_DATE_PROPERTY_NAME])),d=[],l=new Map;n.forEach((e=>{for(const n of t.ADD_TO_NOTION_MARK)if(e.summary&&e.summary.startsWith(n)){d.push(e),e.summary=e.summary.substring(n.length);break}e.description&&e.description.startsWith(t.ADDED_TO_NOTION_MARK)&&l.set(e.id,e)}));for(const e of _){const{pageStart:n,pageEnd:a,isPageOneDayAllDAy:_}=s.makePageState(e),d=e.properties[t.NOTION_GCAL_ID_PROPERTY_NAME].rich_text[0];if(d){const s=d.plain_text,O=l.get(s);if(O){const{eventStart:d,eventEnd:T,isEventOneDayAllDay:p}=i.makeEventState(O),E=o.makePageId(O);if(l.delete(s),n==d&&(_&&p||!_&&a==T||null==a&&!_&&n+t.DEFAULT_RANGE==T));else if(Date.parse(e.last_edited_time)>Date.parse(O.updated)){const n=e.properties.Name.title[0]?e.properties.Name.title[0].text.content:"";r.update_events.push(Object.assign({id:e.properties[t.NOTION_GCAL_ID_PROPERTY_NAME].rich_text[0].plain_text,summary:n},o.makeCalendarEventDate(e)))}else r.update_pages.push({id:E,date:o.makeNotionPageDate(O),name:e.properties.Name.title[0].text.content})}else r.delete_pages.push({id:e.id})}else r.create_events.push(Object.assign({page_id:e.id,description:o.makeEventDescription(e),summary:e.properties.Name.title[0].text.content},o.makeCalendarEventDate(e)))}for(const[e,t]of Array.from(l))r.delete_events.push({id:t.id});for(const e of Array.from(d))r.create_pages.push({name:e.summary,gcal_id:e.id,event_description:e.description||"",date:o.makeNotionPageDate(e)});return[{json:r}]}})(),a)this[s]=a[s];a.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();return main(items)
